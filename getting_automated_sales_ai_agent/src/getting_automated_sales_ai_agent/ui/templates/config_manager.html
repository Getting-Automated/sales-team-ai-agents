<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales AI Agents Configuration Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        .ui-autocomplete {
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 9999;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            padding: 6px 0;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }
        .ui-autocomplete::-webkit-scrollbar {
            width: 8px;
        }
        .ui-autocomplete::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 4px;
        }
        .ui-autocomplete::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 4px;
            border: 2px solid #f7fafc;
        }
        .ui-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 0.95rem;
        }
        .ui-menu-item:hover {
            background-color: #f3f4f6;
        }
        .ui-state-active {
            background-color: #e5e7eb !important;
            border: none !important;
            margin: 0 !important;
        }
        .helper-text {
            font-size: 0.875rem;
            color: #6B7280;
            margin-top: 0.25rem;
        }
    </style>
    <script src="../static/js/suggestions.js"></script>
    <script src="../static/js/config_manager.js"></script>
</head>
<body class="bg-gray-100">
    <!-- ... existing header code ... -->

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8">Getting Automated Sales AI Agent Lead Scoring Configuration</h1>
        
        <!-- Target Profile Overview -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">Target Profile Overview</h2>
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Who are your ideal prospects?</label>
                <textarea 
                    class="border rounded px-3 py-2 w-full h-32" 
                    id="targetOverview"
                    placeholder="Describe your ideal prospect and company profile. Example: Senior decision-makers in companies that have [specific characteristics], particularly those with experience in [relevant areas]..."
                ></textarea>
                <div class="helper-text">This helps our AI understand which leads to prioritize from your list</div>
            </div>
        </div>
    
        <!-- Target Company Parameters -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">Target Company Parameters</h2>
            
            <!-- Company Size -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Company Size</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Employee Count Range</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" class="border rounded px-3 py-2 w-full" id="minEmployees" placeholder="Min">
                            <span>to</span>
                            <input type="number" class="border rounded px-3 py-2 w-full" id="maxEmployees" placeholder="Max">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Revenue Range (Optional)</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" class="border rounded px-3 py-2 w-full" id="minRevenue" placeholder="Min">
                            <span>to</span>
                            <input type="number" class="border rounded px-3 py-2 w-full" id="maxRevenue" placeholder="Max">
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- Target Industries -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Target Industries</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-industry" 
                        id="industryInput" 
                        placeholder="Type or select an industry...">
                    <button onclick="addCustomOrSuggested('industryInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: SaaS, Manufacturing, Healthcare, Financial Services</div>
                <div id="industryTags" class="flex flex-wrap gap-2"></div>
            </div>
    
            <!-- Technologies -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Target Technologies/Tools</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-technologies" 
                        id="techInput" 
                        placeholder="Type or select a technology...">
                    <button onclick="addCustomOrSuggested('techInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: CRM systems, ERP software, Cloud platforms, Industry-specific tools</div>
                <div id="techTags" class="flex flex-wrap gap-2"></div>
            </div>
    
            <!-- Growth Stage -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Growth Stage</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-growthStage" 
                        id="growthStageInput" 
                        placeholder="Type or select a growth stage...">
                    <button onclick="addCustomOrSuggested('growthStageInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: Early Stage Startup, Scale-up, Enterprise</div>
                <div id="growthStageTags" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Geographic Location -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Geographic Location</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-locations" 
                        id="locationInput" 
                        placeholder="Type or select a location...">
                    <button onclick="addCustomOrSuggested('locationInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: North America, Europe, Remote</div>
                <div id="locationTags" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Business Model -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Business Model</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-businessModel" 
                        id="businessModelInput" 
                        placeholder="Type or select a business model...">
                    <button onclick="addCustomOrSuggested('businessModelInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: B2B, B2C, D2C, SaaS</div>
                <div id="businessModelTags" class="flex flex-wrap gap-2"></div>
            </div>
    
        </div>

    
        <!-- Target Individual Parameters -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">Target Individual Parameters</h2>
    
            <!-- Job Titles -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Target Job Titles</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-jobTitles" 
                        id="titleInput" 
                        placeholder="Type or select a job title...">
                    <button onclick="addCustomOrSuggested('titleInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: CEO, VP of Sales, Director of Operations, IT Manager</div>
                <div id="titleTags" class="flex flex-wrap gap-2"></div>
            </div>
    
            <!-- Decision Making Authority -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Decision Making Authority</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-authority" 
                        id="authorityInput" 
                        placeholder="Type or select authority level...">
                    <button onclick="addCustomOrSuggested('authorityInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: Final Decision Maker, Key Influencer, Budget Holder</div>
                <div id="authorityTags" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Negative Criteria -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Negative Criteria (Exclusions)</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-negativeCriteria" 
                        id="negativeInput" 
                        placeholder="Type criteria to exclude...">
                    <button onclick="addCustomOrSuggested('negativeInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: Recently Downsized, Competitor, Limited Budget</div>
                <div id="negativeTags" class="flex flex-wrap gap-2"></div>
            </div>
    
            <!-- Departments -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Target Departments</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-departments" 
                        id="deptInput" 
                        placeholder="Type or select a department...">
                    <button onclick="addCustomOrSuggested('deptInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: Sales, Marketing, IT, Operations, Finance</div>
                <div id="deptTags" class="flex flex-wrap gap-2"></div>
            </div>
    
            <!-- Required Skills/Experience -->
            <div class="mb-6">
                <h3 class="text-lg font-medium mb-3">Required Skills/Experience</h3>
                <div class="flex items-center space-x-2 mb-2">
                    <input type="text" 
                        class="border rounded px-3 py-2 flex-grow autocomplete-skills" 
                        id="skillInput" 
                        placeholder="Type or select a skill...">
                    <button onclick="addCustomOrSuggested('skillInput')" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
                </div>
                <div class="helper-text">Examples: Project Management, Team Leadership, Strategic Planning, Industry Expertise</div>
                <div id="skillTags" class="flex flex-wrap gap-2"></div>
            </div>
        </div>
    
        <!-- Weight Adjustment -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <h4 class="text-xl font-medium mb-4">Agent Scoring Weights</h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Individual Score -->
                <div>
                    <label class="block text-sm font-medium mb-1">Individual Score Weight</label>
                    <input type="range" min="0" max="100" value="25" class="w-full" id="individualWeight">
                    <div class="flex justify-between mt-1">
                        <span class="text-sm text-gray-600" id="individualWeightValue">25%</span>
                        <span class="text-xs text-gray-500">Role alignment and decision-making authority</span>
                    </div>
                </div>

                <!-- Company Score -->
                <div>
                    <label class="block text-sm font-medium mb-1">Company Score Weight</label>
                    <input type="range" min="0" max="100" value="25" class="w-full" id="companyWeight">
                    <div class="flex justify-between mt-1">
                        <span class="text-sm text-gray-600" id="companyWeightValue">25%</span>
                        <span class="text-xs text-gray-500">Company size, industry, and business model fit</span>
                    </div>
                </div>

                <!-- Technical Score -->
                <div>
                    <label class="block text-sm font-medium mb-1">Technical Score Weight</label>
                    <input type="range" min="0" max="100" value="25" class="w-full" id="technicalWeight">
                    <div class="flex justify-between mt-1">
                        <span class="text-sm text-gray-600" id="technicalWeightValue">25%</span>
                        <span class="text-xs text-gray-500">Technical stack and integration potential</span>
                    </div>
                </div>

                <!-- Market Score -->
                <div>
                    <label class="block text-sm font-medium mb-1">Market Score Weight</label>
                    <input type="range" min="0" max="100" value="25" class="w-full" id="marketWeight">
                    <div class="flex justify-between mt-1">
                        <span class="text-sm text-gray-600" id="marketWeightValue">25%</span>
                        <span class="text-xs text-gray-500">Market size and growth potential</span>
                    </div>
                </div>
            </div>

            <!-- Total Weight Display -->
            <div class="mt-6 p-4 bg-white rounded-lg">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">Total Weight</span>
                    <span class="text-sm font-medium" id="totalWeight">100%</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-blue-600 transition-all duration-300" id="totalWeightBar" style="width: 100%"></div>
                </div>
                <p class="text-sm text-gray-500 mt-2">Note: Total weight will automatically balance to 100%</p>
            </div>
        </div>

    <!-- Save Configuration -->
    <div class="flex justify-end">
        <button class="bg-blue-600 text-white px-8 py-3 mt-4 rounded-lg font-medium hover:bg-blue-700" onclick="saveConfiguration()">
            Save Configuration
        </button>
    </div>

</div>
    <script>
        // Helper function to show tooltips
        function showTooltip(elementId, message, type = 'error') {
            const input = $(`#${elementId}`);
            const tooltip = $(`<div class="absolute z-20 px-2 py-1 text-sm rounded ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white">${message}</div>`);
            
            input.parent().append(tooltip);
            tooltip.css({
                top: input.position().top - tooltip.height() - 5,
                left: input.position().left
            });
            
            setTimeout(() => tooltip.fadeOut('fast', function() { $(this).remove(); }), 2000);
        }

        // Function to remove tags
        function removeTag(button) {
            $(button).parent().remove();
        }

        function addTag(inputId, tagsId, type) {
            const input = $(`#${inputId}`);
            const value = input.val().trim();
            
            if (value) {
                // Check if value already exists
                const existingTags = $(`#${tagsId} .text-blue-800`).map(function() {
                    return $(this).text().toLowerCase();
                }).get();
                
                if (existingTags.includes(value.toLowerCase())) {
                    showTooltip(inputId, 'This entry already exists');
                    return;
                }

                // Create tag with custom indicator if needed
                const tag = $(`
                    <div class="inline-flex items-center bg-blue-100 rounded px-2 py-1 mr-2 mb-2 group">
                        <span class="text-blue-800">${value}</span>
                        ${type === 'custom' ? '<span class="ml-1 text-xs text-blue-600">(custom)</span>' : ''}
                        <button onclick="removeTag(this)" class="ml-2 text-blue-600 hover:text-blue-800" title="Remove">×</button>
                    </div>
                `);
                
                $(`#${tagsId}`).append(tag);
                input.val('');
                
                // Show success tooltip
                showTooltip(inputId, 'Added successfully', 'success');
            }
}

        // Function to add custom or suggested values
        function addCustomOrSuggested(inputId) {
            const $input = $(`#${inputId}`);
            const value = $input.val().trim();
            if (value) {
                const suggestionMappings = {
                    'industryInput': 'industries',
                    'techInput': 'technologies',
                    'growthStageInput': 'growthStages',
                    'businessModelInput': 'businessModel',
                    'locationInput': 'locations',
                    'deptInput': 'departments',
                    'titleInput': 'jobTitles',
                    'authorityInput': 'decisionMakingAuthority',
                    'negativeInput': 'negativeCriteria',
                    'skillInput': 'skills'
                };
                
                const suggestionType = suggestionMappings[inputId];
                const suggestionList = suggestions[suggestionType] || [];
                const type = suggestionList.includes(value) ? 'suggested' : 'custom';
                addTag(inputId, `${inputId.replace('Input', 'Tags')}`, type);
            }
        }

        // Initialize everything when document is ready
        $(document).ready(function() {
            const inputMappings = {
                'industryInput': 'industryList',
                'techInput': 'techList',
                'titleInput': 'titleList',
                'deptInput': 'deptList',
                'skillInput': 'skillList',
                'growthStageInput': 'growthStageList',
                'locationInput': 'locationList',
                'businessModelInput': 'businessModelList',
                'authorityInput': 'authorityList',
                'negativeInput': 'negativeList'
            };

            // Handle Enter key and Add button for each input
            Object.keys(inputMappings).forEach(inputId => {
                const $input = $(`#${inputId}`);
                
                // Handle Enter key
                $input.keypress(function(e) {
                    if (e.which === 13) {
                        e.preventDefault();
                        addCustomOrSuggested(inputId);
                    }
                });

                // Handle Add button click
                $input.next('button').click(function(e) {
                    e.preventDefault();
                    addCustomOrSuggested(inputId);
                });
            });
        });

        // Initialize tag containers and event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tag containers
            const tagContainers = [
                'growthStageTags',
                'locationTags',
                'businessModelTags',
                'authorityTags',
                'negativeTags',
                'industryTags',
                'techTags',
                'titleTags',
                'deptTags',
                'skillTags'
            ];
            
            // Add event listeners for Enter key on all input fields
            tagContainers.forEach(containerId => {
                const input = document.getElementById(containerId.replace('Tags', 'Input'));
                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            addCustomOrSuggested(this.id);
                            e.preventDefault();
                        }
                    });
                }
            });
        });

        // Sample lead templates
        const leadTemplates = {
            tech_executive: {
                name: "Sarah Chen",
                role: "CTO",
                company: "TechFlow Solutions",
                businessModel: {
                    type: "B2B SaaS",
                    focus: "Enterprise Solutions",
                    approach: "Value-based Selling"
                },
                background: {
                    expertise: "Technical Implementation",
                    decision_making: "Budget Authority",
                    initiatives: ["Digital Transformation", "Process Automation"]
                },
                technical: {
                    stack: "Modern",
                    integration: "API-ready",
                    systems: ["AWS", "Kubernetes", "Microservices"]
                },
                scoring: {
                    customerAlignment: "high",
                    growthChallenges: "high",
                    marketApproach: "high",
                    domainExpertise: "high",
                    decisionMaking: "high",
                    projectAlignment: "high",
                    techAlignment: "high",
                    integrationPotential: "high"
                }
            },
            sales_leader: {
                name: "Michael Rodriguez",
                role: "VP of Sales",
                company: "CloudScale Inc",
                businessModel: {
                    type: "B2B/B2C Mix",
                    focus: "Mid-market",
                    approach: "Mixed Approach"
                },
                background: {
                    expertise: "Sales Operations",
                    decision_making: "Influence without Authority",
                    initiatives: ["Sales Process Optimization"]
                },
                technical: {
                    stack: "Mixed Legacy/Modern",
                    integration: "Basic Integration",
                    systems: ["Salesforce", "HubSpot"]
                },
                scoring: {
                    customerAlignment: "medium",
                    growthChallenges: "medium",
                    marketApproach: "medium",
                    domainExpertise: "medium",
                    decisionMaking: "medium",
                    projectAlignment: "medium",
                    techAlignment: "medium",
                    integrationPotential: "medium"
                }
            },
            startup_founder: {
                name: "Emma Watson",
                role: "CEO & Technical Founder",
                company: "DataMind AI",
                businessModel: {
                    type: "B2C Focus",
                    focus: "Small Business",
                    approach: "Transactional"
                },
                background: {
                    expertise: "Unrelated",
                    decision_making: "No Clear Influence",
                    initiatives: ["General Growth"]
                },
                technical: {
                    stack: "Legacy",
                    integration: "Manual Processes",
                    systems: ["Basic CRM"]
                },
                scoring: {
                    customerAlignment: "low",
                    growthChallenges: "low",
                    marketApproach: "low",
                    domainExpertise: "low",
                    decisionMaking: "low",
                    projectAlignment: "low",
                    techAlignment: "low",
                    integrationPotential: "low"
                }
            }
        };

        // Load sample lead data
        function loadSampleLead() {
            const template = $("#sampleLeadTemplate").val();
            if (template && leadTemplates[template]) {
                $("#sampleLead").val(JSON.stringify(leadTemplates[template], null, 2));
            }
        }

        // Add business model indicator
        function addBusinessModel() {
            const input = $("#businessModelInput");
            const value = input.val().trim();
            if (value) {
                const tag = $(`<div class="inline-flex items-center bg-blue-100 rounded px-2 py-1 mr-2 mb-2">
                    <span class="text-blue-800">${value}</span>
                    <button onclick="removeTag(this, 'businessModel')" class="ml-2 text-blue-600 hover:text-blue-800" title="Remove">×</button>
                </div>`);
                $("#businessModelTags").append(tag);
                input.val('');
            }
        }

        // Add domain expertise
        function addDomain() {
            const input = $("#domainInput");
            const value = input.val().trim();
            if (value) {
                const tag = $(`<div class="inline-flex items-center bg-green-100 rounded px-2 py-1 mr-2 mb-2">
                    <span class="text-green-800">${value}</span>
                    <button onclick="removeTag(this, 'domain')" class="ml-2 text-green-600 hover:text-green-800" title="Remove">×</button>
                </div>`);
                $("#domainTags").append(tag);
                input.val('');
            }
        }

        // Add growth indicator
        function addGrowthIndicator() {
            const input = $("#growthInput");
            const value = input.val().trim();
            if (value) {
                const tag = $(`<div class="inline-flex items-center bg-purple-100 rounded px-2 py-1 mr-2 mb-2">
                    <span class="text-purple-800">${value}</span>
                    <button onclick="removeTag(this, 'growth')" class="ml-2 text-purple-600 hover:text-purple-800" title="Remove">×</button>
                </div>`);
                $("#growthTags").append(tag);
                input.val('');
            }
        }

        // Remove tag
        function removeTag(button, type) {
            $(button).parent().remove();
        }

        // Get tags
        function getTags(type) {
            return $(`#${type}Tags .text-${type === 'businessModel' ? 'blue' : type === 'domain' ? 'green' : 'purple'}-800`).map(function() {
                return $(this).text();
            }).get();
        }

        // Update weight displays
        function updateWeights(event) {
            const weights = {
                individual: parseInt($("#individualWeight").val()),
                company: parseInt($("#companyWeight").val()),
                technical: parseInt($("#technicalWeight").val()),
                market: parseInt($("#marketWeight").val())
            };

            // If a weight was changed, adjust others proportionally
            if (event) {
                const changedId = event.target.id;
                const changedValue = weights[changedId.replace('Weight', '')];
                const otherWeights = Object.keys(weights).filter(key => key + 'Weight' !== changedId);
                
                // Calculate total of other weights
                const totalOtherWeights = otherWeights.reduce((sum, key) => sum + weights[key], 0);
                
                if (totalOtherWeights > 0) {
                    // Adjust other weights proportionally
                    const remainingTotal = 100 - changedValue;
                    otherWeights.forEach(key => {
                        const proportion = weights[key] / totalOtherWeights;
                        weights[key] = Math.round(remainingTotal * proportion);
                        $(`#${key}Weight`).val(weights[key]);
                    });
                } else {
                    // If all other weights are 0, distribute equally
                    const remainingTotal = 100 - changedValue;
                    const equalShare = Math.round(remainingTotal / otherWeights.length);
                    otherWeights.forEach(key => {
                        weights[key] = equalShare;
                        $(`#${key}Weight`).val(equalShare);
                    });
                }
            }

            // Update display values
            $("#individualWeightValue").text(weights.individual + "%");
            $("#companyWeightValue").text(weights.company + "%");
            $("#technicalWeightValue").text(weights.technical + "%");
            $("#marketWeightValue").text(weights.market + "%");
        }

        // Add event listeners for all weight sliders
        $(document).ready(function() {
            $("#individualWeight, #companyWeight, #technicalWeight, #marketWeight").on('input', updateWeights);
        });

        // Calculate score
        function calculateScore() {
            const weights = {
                individual: parseInt($("#individualWeight").val()) / 100,
                company: parseInt($("#companyWeight").val()) / 100,
                technical: parseInt($("#technicalWeight").val()) / 100,
                market: parseInt($("#marketWeight").val()) / 100
            };

            const scoreValues = {
                high: 1.0,
                medium: 0.5,
                low: 0.0
            };

            // Individual Profile Score
            const individualScore = (
                scoreValues[document.getElementById('jobLevel').value] +
                scoreValues[document.getElementById('expertise').value]
            ) / 2 * weights.individual;

            // Company Profile Score
            const companyScore = (
                scoreValues[document.getElementById('companySize').value] +
                scoreValues[document.getElementById('industryAlignment').value]
            ) / 2 * weights.company;

            // Technical Score
            const technicalScore = (
                scoreValues[document.getElementById('techStack').value] +
                scoreValues[document.getElementById('integration').value]
            ) / 2 * weights.technical;

            // Market Score
            const marketScore = (
                scoreValues[document.getElementById('marketSize').value] +
                scoreValues[document.getElementById('growthPotential').value]
            ) / 2 * weights.market;

            const totalScore = (individualScore + companyScore + technicalScore + marketScore) * 100;
            return {
                total: totalScore.toFixed(1),
                breakdown: {
                    individual: (individualScore * 100).toFixed(1),
                    company: (companyScore * 100).toFixed(1),
                    technical: (technicalScore * 100).toFixed(1),
                    market: (marketScore * 100).toFixed(1)
                }
            };
        }

        // Show test results
        function showTestResults() {
            const score = calculateScore();
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold mb-2">Lead Score: ${score.total}%</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Individual Profile (${$("#individualWeight").val()}%):</span>
                            <span>${score.breakdown.individual}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Company Profile (${$("#companyWeight").val()}%):</span>
                            <span>${score.breakdown.company}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Technical Alignment (${$("#technicalWeight").val()}%):</span>
                            <span>${score.breakdown.technical}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Market Alignment (${$("#marketWeight").val()}%):</span>
                            <span>${score.breakdown.market}%</span>
                        </div>
                    </div>
                    <div class="mt-4 p-3 ${getRecommendationClass(score.total)} rounded">
                        <span class="font-medium">Recommendation: </span>
                        ${getRecommendationText(score.total)}
                    </div>
                </div>
            `;
        }

        function getRecommendationClass(score) {
            if (score >= 75) return 'bg-green-100';
            if (score >= 50) return 'bg-yellow-100';
            return 'bg-red-100';
        }

        function getRecommendationText(score) {
            if (score >= 75) {
                return 'High-priority prospect - Perfect ICP match with strong potential for success. Immediate engagement recommended.';
            } else if (score >= 50) {
                return 'Moderate fit - Good potential but may need specific focus areas. Consider targeted engagement strategy.';
            } else {
                return 'Low fit - Significant gaps in alignment. May not be ideal target at this time.';
            }
        }

        async function saveConfiguration() {
    // Get minimum requirements values
            const companyRevenueMin = $("#minRevenue").val().trim();
            const companyRevenueMax = $("#maxRevenue").val().trim();
            const employeeCountMin = parseInt($("#minEmployees").val()) || null;
            const employeeCountMax = parseInt($("#maxEmployees").val()) || null;

            const config = {
                customer_icp: {
                    profile_overview: $("#targetOverview").val().trim(),
                    weights: {
                        individual: parseInt($("#individualWeight").val()) || 25,
                        company: parseInt($("#companyWeight").val()) || 25,
                        technical: parseInt($("#technicalWeight").val()) || 25,
                        market: parseInt($("#marketWeight").val()) || 25
                    },
                    tags: {
                        industries: Array.from(document.querySelectorAll('#industryTags .text-blue-800')).map(tag => tag.textContent.trim()),
                        business_models: Array.from(document.querySelectorAll('#businessModelTags .text-blue-800')).map(tag => tag.textContent.trim()),
                        technologies: Array.from(document.querySelectorAll('#techTags .text-blue-800')).map(tag => tag.textContent.trim()),
                        locations: Array.from(document.querySelectorAll('#locationTags .text-blue-800')).map(tag => tag.textContent.trim()),
                        growth_stages: Array.from(document.querySelectorAll('#growthStageTags .text-blue-800')).map(tag => tag.textContent.trim())
                    },
                    target_departments: Array.from(document.querySelectorAll('#deptTags .text-blue-800')).map(tag => tag.textContent.trim()),
                    job_titles: Array.from(document.querySelectorAll('#titleTags .text-blue-800')).map(tag => tag.textContent.trim()),
                    decision_making_authority: Array.from(document.querySelectorAll('#authorityTags .text-blue-800')).map(tag => tag.textContent.trim()),
                    negative_criteria: Array.from(document.querySelectorAll('#negativeTags .text-blue-800')).map(tag => tag.textContent.trim()),
                    required_skills: Array.from(document.querySelectorAll('#skillTags .text-blue-800')).map(tag => tag.textContent.trim()),
                    minimum_requirements: {
                        ...(companyRevenueMin && { company_revenue_min: parseInt(companyRevenueMin) }),
                        ...(companyRevenueMax && { company_revenue_max: parseInt(companyRevenueMax) }),
                        ...(employeeCountMin && { employee_count_min: employeeCountMin }),
                        ...(employeeCountMax && { employee_count_max: employeeCountMax })
                    }
                }
            };

            try {
                // Convert config object to YAML string
                const yamlString = jsyaml.dump(config, {
                    indent: 2,
                    lineWidth: -1,
                    noRefs: true
                });

                // Use File System Access API to save the file
                try {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: 'config.yaml',
                        types: [{
                            description: 'YAML files',
                            accept: {
                                'text/yaml': ['.yaml', '.yml']
                            }
                        }]
                    });

                    const writable = await handle.createWritable();
                    await writable.write(yamlString);
                    await writable.close();

                    showNotification('Configuration saved successfully', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        throw err;
                    }
                }
            } catch (error) {
                console.error('Error saving configuration:', error);
                showNotification('Error saving configuration', 'error');
            }
        }

        function loadConfiguration(config) {
            if (!config || !config.customer_icp) return;
            
            const icp = config.customer_icp;
            
            // Load weights
            if (icp.weights) {
                $("#individualWeight").val(icp.weights.individual || 25);
                $("#companyWeight").val(icp.weights.company || 25);
                $("#technicalWeight").val(icp.weights.technical || 25);
                $("#marketWeight").val(icp.weights.market || 25);
                updateWeights();
            }

            // Load minimum requirements
            if (icp.minimum_requirements) {
                $("#minRevenue").val(icp.minimum_requirements.company_revenue || '');
                $("#minEmployees").val(icp.minimum_requirements.employee_count || '');
            }

            // Clear existing tags
            $('.tag').remove();

            // Load tags
            if (icp.tags) {
                icp.tags.industries?.forEach(tag => addTag('industryInput', 'industryTags', tag));
                icp.tags.business_models?.forEach(tag => addTag('businessModelInput', 'businessModelTags', tag));
                icp.tags.domains?.forEach(tag => addTag('domainInput', 'domainTags', tag));
                icp.tags.growth_indicators?.forEach(tag => addTag('growthInput', 'growthTags', tag));
                icp.tags.technologies?.forEach(tag => addTag('techInput', 'techTags', tag));
                icp.tags.locations?.forEach(tag => addTag('locationInput', 'locationTags', tag));
                icp.tags.growth_stages?.forEach(tag => addTag('growthStageInput', 'growthStageTags', tag));
            }

            // Load departments
            icp.target_departments?.forEach(tag => addTag('deptInput', 'departmentTags', tag));
        }

        // Show notification
        function showNotification(message, type) {
            const notification = $(`<div class="fixed top-4 right-4 px-6 py-3 rounded shadow-lg ${
                type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }">${message}</div>`);
            $("body").append(notification);
            setTimeout(() => {
                notification.fadeOut(300, function() { $(this).remove(); });
            }, 3000);
        }

        // Initialize autocomplete and event handlers
        $(document).ready(function() {
            console.log('Document ready, initializing autocomplete...');
            
            function initializeAutocomplete(selector, suggestions) {
                $(selector).autocomplete({
                    source: suggestions,
                    minLength: 0,  // Show all options even when empty
                    position: { my: "left top", at: "left bottom" },
                    open: function() {
                        $(this).autocomplete('widget').css('z-index', 9999);
                    }
                }).on('click focus', function() {
                    // Show all suggestions when clicking or focusing on the input
                    $(this).autocomplete('search', '');
                });

                // Add dropdown arrow and styling
                const wrapper = $(selector).parent();
                $(selector).css({
                    'background-image': 'url("data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 24 24\' stroke=\'%236B7280\'%3E%3Cpath stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M19 9l-7 7-7-7\'%3E%3C/path%3E%3C/svg%3E")',
                    'background-repeat': 'no-repeat',
                    'background-position': 'right 8px center',
                    'background-size': '20px',
                    'padding-right': '32px'
                });
            }

            // Initialize all autocomplete fields
            if (window.suggestions) {
                console.log('Initializing autocomplete with suggestions:', Object.keys(window.suggestions));
                
                initializeAutocomplete(".autocomplete-industry", window.suggestions.industries);
                initializeAutocomplete(".autocomplete-technologies", window.suggestions.technologies);
                initializeAutocomplete(".autocomplete-growthStage", window.suggestions.growthStages);
                initializeAutocomplete(".autocomplete-locations", window.suggestions.locations);
                initializeAutocomplete(".autocomplete-jobTitles", window.suggestions.jobTitles);
                initializeAutocomplete(".autocomplete-authority", window.suggestions.authority);
                initializeAutocomplete(".autocomplete-negativeCriteria", window.suggestions.negativeCriteria);
                initializeAutocomplete(".autocomplete-departments", window.suggestions.departments);
                initializeAutocomplete(".autocomplete-skills", window.suggestions.skills);
                initializeAutocomplete(".autocomplete-businessModel", window.suggestions.businessModel);
            } else {
                console.error('Suggestions not loaded! Check if suggestions.js is loaded properly.');
            }
        });
    </script>
</body>
</html>